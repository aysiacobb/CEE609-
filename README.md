## Background
The broader research focus of this project is the evaluation of machine learning algorithms for environmental data analysis and prediction. Specifically, this project  investigates the accuracy and effectiveness of using a machine learning algorithm to predict a water quality parameter in the Chesapeake Bay estuary using a combination of satellite-derived data and direct in-situ measurements. The motivation for this project stems from the growing role of artificial intelligence in all industries. However, artificial intelligence when properly trained can be utilized for addressing environmental challenges, specifically those exacerbated by climate change. Traditional water quality monitoring methods often face limitations in spatial and temporal coverage, making machine learning a more promising alternative for generating comprehensive as well as accurate predictions. Machine learning algorithms are a subset of artificial intelligence, and have shown potential for predicting various climate change related outcomes, including crop yields, coastal erosion, and water quality. By leveraging the capabilities of artificial intelligence and machine learning algorithms, this project aims to enhance environmental data research and understand how contributions to more effective monitoring and management strategies can be made as a result. The broader topic of artificial intelligence and environment data research is of significant personal interest as it combines innovative technology with a commitment to addressing environmental issues.

## Literature Review
Five scientific journals were examined to guide the research for this project. The first paper will be referred to by A1 and is titled “Integrating multisensor satellite data merging and image reconstruction in support of machine learning for better water quality management”. A1 explores the integration of multisensor satellite data with machine learning techniques to enhance water quality management in Central America (Lake Nicaragua located between Costa Rica and Nicaragua). The study aimed to propose a shift to automate water quality monitoring with the use of machine learning techniques. The techniques for machine learning and data mining used for A1 consisted of artificial neural networks, deep learning, and fast learning. The results of A1 demonstrated that the real world application in Lake Nicaragua worked well in characterizing complex relationships between real-world samples and ocean color reflectance products. The next paper, A2 is titled “Simultaneous retrieval of selected optical water quality indicators from Landsat-8, Sentinel-2, and Sentinel-3”. A2 used a machine learning approach to estimate key water quality indicators including chlorophyll-a, total suspended solids and the absorption by colored dissolved organic matter at 440 nm (aCDOM(440)) using data from multiple satellite sensors. A2’s researchers used mixture density networks (MDN) to process the spectral measurements and then training the MDNs using in-situ measurements. In A2, they were trying to get the model to learn the relationship between spectral reflectance and water quality parameters. The findings of A2 suggest that MDNs can be used as a global algorithm for retrieval of chlorophyll-a, total suspended solids, and aCDOM(440) from multi-source satellite imagery which overall enhances the monitoring and management of water quality. The third paper A3 is titled “Machine learning methods for better water quality prediction“. A3 investigates the application of multiple machine learning techniques to predict water quality parameters in the Johor River Basin in Malaysia. The water quality parameters of interest include ammoniacal nitrogen, suspended solids, and pH and the modeling systems used included adaptive neuro-fuzzy inference system (ANFIS), radial basis function neural networks (RBF-ANN), and multi-layer perceptron neural networks (MLP-ANN). The results of A3 showed that the ANFIS model performed the best with a R2 value of 0.9 or above for all parameters tested suggesting that ANFIS is a great framework for accurate water quality prediction. A4 is titled “An Alternative to Laboratory Testing: Random Forest-Based Water Quality Prediction Framework for Inland and Nearshore Water Bodies”. A4’s objective was a proposition of a random forest based prediction model that utilizes environmental and water quality parameters in order to predict water quality indicators in an effort to provide an alternative to costly and time-consuming laboratory testing. Remote sensing and in-situ measurements were included to train the model and the model was trained to predict chlorophyll-a concentration as well as dissolved oxygen phosphorus, and nitrogen. The findings of A4 showed that the random forest model showed a high prediction accuracy outperforming linear regressions and support vector machines and was effective in inland and nearshore environments. A4 demonstrated that a machine learning based approach to water quality was promising as it was cost effective, offered real time predictions, and has numerous applications. The final paper, A5 is titled “Spatial heterogeneity modeling of water quality based on random forest regression and model interpretation”. The goal of A5 was to establish an analytical framework to explore how natural and anthropogenic watershed features affect water quality on a spatial scale in the Taihu Lake basin of Zhejiang province in China. A5 applied a random forest regression model to three water quality parameters total phosphorus, total nitrogen, and namely permanganate index (CODMn) to assess the model's success. A5 results showed that  machine learning models can be used to predict water quality to compensate for a lack of physical monitoring stations in some areas. However, A5 researchers stated that the adopted features of the random forest regression could not fully explain variations in the water quality. Therefore, more studies need to be conducted to improve accuracy of models while also helping with the interpretation of key features/driving factors. The citations for the papers mentioned above are as follows:
* Chang, N.-B., Bai, K., & Chen, C.-F. (2017, June 28). Integrating multisensor satellite data merging and image reconstruction in support of machine learning for Better Water Quality Management. Journal of Environmental Management. 
* Pahlevan, N., Smith, B., Alikas, K., Anstee, J., & Barbosa, C. (2022, January 4). Simultaneous retrieval of selected optical water quality indicators from landsat-8, sentinel-2, and sentinel-3. Remote Sensing of Environment. https://www.sciencedirect.com/science/article/pii/S0034425721005800 
* Abrahart, R. J., Avci, E., Bowden, G. J., Chang, F.-J., Cigizoglu, H. K., Dogan, E., Dohan, K., Firat, M., Hull, V., Kim, B., Kişi, Kuo, J.-T., Lek, S., Li, S.-T., Moatar, F., Nash, J. E., Palani, S., Sheta, A. F., Singh, K. P., … Yu, L. (2019, August 27). Machine learning methods for better water quality prediction. Journal of Hydrology. https://www.sciencedirect.com/science/article/pii/S0022169419308194
* Xu, J., Xu, Z., Kuang, J., Lin, C., Xiao, L., Huang, X., & Zhang, Y. (2021b, November 17). An alternative to laboratory testing: Random Forest-based water quality prediction framework for inland and Nearshore Water Bodies. MDPI. https://www.mdpi.com/2073-4441/13/22/3262 
* Altenburger, R., Álvarez-Cabria, M., Banger, K., Bostanmaneshrad, F., Braswell, A. S., Chen, K., Chen, Q., Cui, N., Clercq, D. D., Feng, L., Fernández, D., Giri, S., Kaur, M., … Zhang, W. (2021, July 12). Spatial heterogeneity modeling of water quality based on random forest regression and model interpretation. Environmental Research. https://www.sciencedirect.com/science/article/abs/pii/S0013935121009543 

Description of the Unknown 
This project explores how effectively machine learning can be leveraged in environmental science and engineering, specifically focusing on the application of machine learning algorithms such as a random forest regression to predict a water quality parameter in the dynamic estuarine system of the Chesapeake Bay, Maryland, USA. Building on insights from previous studies that utilized satellite imagery to predict water quality parameters, this project’s goal is to expand on the successful application of machine learning predictions in managing lakes and river basins through another case study using an estuarine system. The implications of this research are significant, as it demonstrates the potential for machine learning algorithms to transform environmental data research and analysis. While this project does focus on a single water quality parameter, it lays the groundwork for broader applications of machine learning in environmental monitoring and potentially policy and decision-making.

## Research Objective & Question
Objective: Estimating Water Quality in the Chesapeake Bay Using Machine Learning and Multi-Spectral Data
Question: How accurately can chlorophyll-a be predicted using satellite-derived multispectral data and direct in-situ measurements from the Chesapeake Bay watershed? How does the incorporation of satellite-derived multispectral data influence the success of a machine learning model? 

## Data Source Description 
This project used publicly available datasets provided by the Chesapeake Bay Bay Program. The datasets included the CBP Water Quality Database (1984-present), the USGS River Input Monitoring Database (1985-2018), and NASA’s LANDSAT Imagery. The LANDSAT imagery used for this project was processed at Level 2. The CBP Water Quality Dataset has collections from 1984 to present day. It is rebuilt every day from 5:00 to 6:00 am EST. It includes measured and calculated physical and nutrient parameters and provides the in-situ measurements necessary for training the model. The USGS River Input Monitoring Database contains a network called the Chesapeake Bay River Input Monitoring Network. This contains data and metadata from 1985-2018. The information is nitrogen, phosphorus, suspended-sediment loads, and changes in loads, in major rivers across the Chesapeake Bay. This information proved to be helpful when contextualizing factors that affect water quality in the Chesapeake Bay. The NASA LANDSAT Imagery was acquired across multiple years: 2008, 2009, 2012, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022. The goal for the LANDSAT imagery was to obtain reflectance values that correspond to the predictands (water quality parameters selected). All in-situ datasets can be found at the following link : https://www.chesapeakebay.net/what/data . The LANDSAT images can be found at the following link https://earthexplorer.usgs.gov/ .

## Data Processing Description 
Data processing will begin with cleaning and normalizing the data sets. This will be done in Python. To manipulate and work with the dataset, Pandas will be used. Numpy was used for numerical operations and dealing with arrays. Scikit-Learn was used for scaling, encoding or model evaluation. Additionally, for the NASA LANDSAT Imagery, rasterio was used to extract and manipulate the imagery. To normalize the data set Z-scores were applied. Z-scores are the standard convention for random forest regression models, to ensure consistency for all the predictors. Normalizing the data ensures that the different scales for the predictors do not create a bias within the model. 

The predictand for this project was chlorophyll-a. Chlorophyll-a is the pigment that is found in algae, and can be used as an indicator for algal biomass. Chlorophyll-a levels provide insight into nutrient dynamics and potential for algal blooms, which can have significant impacts on the ecosystem health like eutrophication. 

Predictors for this project include satellite derived spectral indices, spectral bands from the LANDSAT imagery, and in-situ measurements. The satellite derived spectral indices include normalized difference water index or NDWI and normalized difference vegetation index or NDVI. These indexes are relevant to water quality monitoring and help assess vegetation health or enhance the presence of water. Spectral bands from the LANDSAT imagery include blue bands, green bands, red bands, and near-infrared bands which are useful for detection and assessments of water and water quality parameters. Using the bands, NDWI and NDVI were manually calculated. Finally, in-situ measurements that were used as predictors are temperature, pH, DO, nitrogen, light attenuation, and phosphorus. Temperature can affect turbidity and chlorophyll-a levels, pH can impact algal growth and has a large impact on water chemistry, DO is significant for aquatic organisms and has a relationship with chlorophyll-a, and nitrogen and phosphorus in excess can lead to algal bloom affecting chlorophyll-a levels. Additionally, light attenuation directly impacts chlorophyll-a concentration by reducing the available light for photosynthesis, which often leads to increased chlorophyll-a concentration when light is limited. The LANDSAT imagery was able to be paired with the in-situ observations, so a window of concomitance was not necessary to establish. 

## Model description 
The machine learning model used was a random forest regression. Random forest regression models are optimal in handling non-linear relationships between predictors and predictands. Additionally, random forest regression is robust to overfitting, missing data, and it is versatile with multiple data types making it a justifiable machine learning model. The model outputs that will be critical for my research objective are the predicted values of chlorophyll-a which will be compared to actual values from the dataset to examine for accuracy. Feature importance is significant as it ranks the importance of each predictor variable within the model, this will help understand which variables carry the most influence in predicting chlorophyll-a. To evaluate the model, metrics such as mean absolute error or MAE, root mean squared error or RMSE, R2 score, and cross validation were used. Each metric evaluates the magnitude of errors leading to the overall accuracy of the model. Additionally, z-scores were used for the normalization of predictor data to ensure the model’s accuracy and robustness. The use of z-scores allows for more consistency of feature contributions for the predictor values. 

## Training/validation plan 
Training random forest regression entails separating the model into a training set and a testing set. Using the scikit-learn package, you can use a function to split the training data into x (predictors) and y (predictands). A 80/20 split for training and test sets was done for the data. After the data is split the random forest model can be trained using the training data set and the fit method in scikit-learn. Using the metrics outlined in the model description section, an evaluation of the model’s accuracy was achieved. 

Two models were trained for this project. The first model was trained using only in-situ measurements and had other water quality parameters such as DO and PH to act as predictors for the target variable CHLA. The second model was trained using both in-situ measurements and LANDSAT imagery. Reflectance values were obtained from the LANDSAT imagery and then incorporated into the dataset with the in-situ measurements. 

## Results
![figure1](https://github.com/user-attachments/assets/2400b113-a957-4ad7-87a4-57f946f7793b)

![figure2](https://github.com/user-attachments/assets/e6fc5c9a-4e00-408a-af1f-90dcd423b24a)

![figure10](https://github.com/user-attachments/assets/f73bd01f-e417-4427-b98e-4bbe384b78e7)

![figure11](https://github.com/user-attachments/assets/847c9f0a-f315-4151-9c91-4b7a9490aab3)

The figures above are a few of the eleven generated for this project. The chosen figures are figure 1, 2, 10, and 11. Figure 1 is the residuals vs actual chlorophyll-a (CHLA) concentration and demonstrates that the residuals range from about -10 to +25 showing a relatively wide magnitude of prediction errors. The residuals cluster close to zero for lower values of CHLA which suggests that the model performs better for smaller concentrations of CHLA. As CHLA concentrations increase, we see more scatter present with the residuals suggesting increasing prediction error. Key insight associated with Figure 1 is that the variable in residuals suggest heteroscedasticity since outliers are evident for high CHLA concentrations. Figure 2 is the actual vs predicted CHLA values. The R2 and RMSE values are displayed in the top left of the figure and demonstrate a good agreement between actual and predicted values showcasing the model’s predictive capability. The R2 value of 0.93 means that 93% of variance in CHLA concentration is explained by the model. The RMSE value is 0.72 and reflects the average magnitude of prediction errors. This value is relatively low which reinforces the model’s accuracy. Next, figure 10 is a seasonal variation plot for CHLA. The spring time which is denoted as March through May has the highest median CHLA concentrations with notable outliers. Winter denoted as December to February, shows consistently low values with minimal variability. The seasonal trend depicted in the plot is that CHLA values peak in spring and decline in colder months. This may be the result of nutrient loading, increased sunlight, or dynamic ecological conditions in Spring months. Finally, figure 11 is a CHLA hotspot map. The red points on the map indicate hotspots which are areas of high CHLA concentration. The northern Chesapeake Bay shows a higher density of hot spots in comparison to the Southern Chesapeake Bay. The map displays spatial heterogeneity as the result of this uneven distribution of hotspots. 

## Discussion 
The quantitative results discussed above are of great significance because of the story they tell about the Chesapeake Bay. The results matter overall because they help with water quality monitoring and management granted using CHLA concentrations as proxy for algal biomass and thus eutrophication. The model itself proved to be reliable for low to moderate CHLA levels, but struggles with extreme concentrations. For general monitoring, the model is trustworthy however in cases of episodic algal blooms, the model would struggle significantly. This could mean that additional predictors need to be included or a different modeling approach should be used for handling high CHLA values. Additionally, as stated previously the predictions the model generated are useful for proactive water quality management, but in the case of extremes they should be validated more intensely. The seasonal trends present are helpful in guiding monitoring and mitigation efforts. For example, based on the model, Spring peaks demonstrate a need for increasing monitoring and nutrient management in order to percent blooms while Winter lows show that algal growth is naturally regulated and limited by environmental conditions. Additionally, using the hotspot analysis, there is a spatial guide for what areas are of the utmost concern. This can inform policymakers to focus efforts on nutrient reduction in hotspot areas, improving overall water quality and lowering the risk of eutrophication. 

The results of the project align with literature discussed in the literature review section. For example, the results confirm conclusions from A3 and A4. Specifically, for A3, the project reaffirms that machine learning techniques can be used for prediction of water quality parameters successfully. Additionally, the project confirms that random forest regression models are indeed successful in their predictive ability for water quality parameters like A4. The results of the project confirm A5 results that more is needed for accuracy in machine learning models. Specifically, in the case of this project more was needed for accuracy for larger CHLA values. 

Assumptions and caveats that could have impacted the results of the predictive ability of this model were the chosen water quality parameters. They were chosen due to their relationship with chlorophyll-and therefore other water quality parameters were excluded. This could explain why larger CHLA values had more variance. Additionally caveats include the model type chosen which was a random forest regression. This was chosen due to the literature available and success of the model type, however every water system is different and a different model type may have been better to capture the relationships present in the data leading to better predictions.

## Conclusion 
The purpose of this project was to evaluate the performance of machine learning in an estuary system as well as the success of the machine learning model with the incorporation of satellite derived data. This purpose stems from the literature reviewed where machine learning predictive capability was analyzed in marine and freshwater systems but not an estuarine system. To carry out this project, two models were trained – one with only in-situ measurements and the other with in-situ measurements and satellite-derived data. Their success was evaluated in comparison based on model metrics such as R2, RMSE, and MAE. The model with both in-situ measurements and satellite-driven data performed significantly better. Other key findings include the hotspot presence of CHLA in the northern part of the CHesapeake Bay as well as the seasonal trend exhibited with Spring peaks and Winter lows. Ultimately, chlorophyll-a concentrations can be accurately predicted in the Chesapeake Bay watershed using machine learning models and that satellite-derived data has a major influence on the success of machine learning models. 


## Repository 
Key elements include data files, scripts, documentation, and results. The data files consist of raw and processed datasets, including in-situ measurements and satellite-derived multispectral data. Links to external datasets, such as the Chesapeake Bay Program data and NASA LANDSAT imagery, are provided. The scripts include Python code for data preprocessing, normalization, visualization, and model training using random forest regression. Detailed documentation is available in this README file, which explains the project scope and data sources. Additionally, the repository includes results such as visualizations and summary tables of model evaluation.

To use the repository for end-to-end analysis, users must first set up the environment by cloning the repository from GitHub and navigating to the project directory. Data cleaning and normalization can be performed using the preprocessing script, while model training and evaluation can be executed using separate scripts for training and assessing the random forest model. Visualization scripts generate plots and figures to aid in understanding the model’s performance and outputs.

The project requires minimal hardware, including a computer with at least 8 GB of RAM and 20 GB of free disk space. The software environment includes Python 3.9 or later, with libraries such as pandas, numpy, scikit-learn, rasterio, matplotlib, and seaborn. 

The repository supports collaborative development with a structured process for submitting merge requests. Users can fork the repository, create a branch for their feature or bug fix, and make their changes. Once changes are committed and pushed to their forked repository, users can submit a pull request for review and integration into the main repository. This workflow ensures that contributions are streamlined and maintain project integrity. The repository is licensed under the MIT License, allowing open-source usage, modification, and distribution with proper attribution. A full license file is included, ensuring compliance and clarity for all users.

